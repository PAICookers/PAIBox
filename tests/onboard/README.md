# OnBoard Tests

## ANN权重映射

|         测试项目          | 结果  |    备注    |
| :-----------------------: | :---: | :--------: |
| [001 单层](#001-单层w8e1) |   ✅   |            |
| [002 单层](#002-单层w8e4) |   ✅   |            |
| [003 单层](#003-单层w2e2) |   ✅   |            |
| [004 单层](#004-单层w4e2) |   ✅   |            |
| [005 多层-1](#005-多层-1) |   ✅   |            |
| [006 多层-2](#006-多层-2) |   ✅   |            |
| [007 单层](#007-单层w4e1) |   ❌   | 芯片不输出 |
| [008 多层-1](#008-多层-1) |   ❌   | 芯片不输出 |

### 无神经元在WRAM

#### 001 单层W=8E=1

测试设置：

- 一层Linear，8bit权重，扇入扩展E=1，Linear尺寸(144, 400)
- 设置Linear `tws=1`，`twe=2`
- 运行5时间步，监测L1输出

检查：

1. 在输出数据中，`ts=1,2` 时刻有数据，`ts>2` 时刻无数据（0）
2. 有效输出数据应与参考输出在每个时间步相等

#### 002 单层W=8E=4

测试设置：

- 一层Linear，8bit权重，扇入扩展E=4，Linear尺寸(500, 100)
- 设置Linear `tws=1`，`twe=0`
- 运行5时间步，监测L1输出

检查：

1. 在输出数据中，每个时刻均有有效数据
2. 有效输出数据应与参考输出在每个时间步相等

#### 003 单层W=2E=2

测试设置：

- 一层Linear，2bit权重，扇入扩展E=2，Linear尺寸(240, 200)
- 设置Linear `bias=99`， `tws=1 `，`twe=0`
- 运行5时间步，监测L1输出

检查：

1. 在输出数据中，每个时刻均有有效数据
2. 有效输出数据应与参考输出在每个时间步相等

#### 004 单层W=4E=2

测试设置：

- 一层Linear，4bit权重，扇入扩展E=2，Linear尺寸(240, 500)
- 设置Linear `tws=1`，`twe=0`
- 运行5时间步，监测L1输出

检查：

1. 在输出数据中，每个时刻均有有效数据
2. 有效输出数据应与参考输出在每个时间步相等

#### 005 多层-1

测试设置：

- 两层Linear，均为8bit权重，扇入扩展E1=4，L1尺寸(200,200)；E2=4，L2尺寸(200,10)
- L2层 `bias=2`，`bit_trunc=9`
- 设置L1 `tws=1`，`twe=0`；L2 `tws=2`，`twe=0`
- 运行5时间步，监测L2输出

检查：

1. 在输出数据中，从第2时刻开始才有有效数据。注意每个时间步L2的输入是上一个时刻的L1输出
2. 有效输出数据应与参考输出在每个时间步相等

#### 006 多层-2

测试设置：

- 两层Linear，均为1bit权重，扇入扩展E1=2，L1尺寸(240,100)；E2=1，L2尺寸(100,10)
- 设置L1 `tws=1`，`twe=0`；L2 `tws=2`，`twe=0`
- 运行5时间步，监测L2输出

检查：

1. 在输出数据中，从第2时刻开始才有有效数据。注意每个时间步L2的输入是上一个时刻的L1输出
2. 有效输出数据应与参考输出在每个时间步相等

### 有神经元在WRAM

#### 007 单层W=4E=1

测试设置：

- 一层Linear，4bit权重，扇入扩展E=1，Linear尺寸(120, 800)，此时可容纳876
- 设置Linear `tws=1`，`twe=0`
- 运行5时间步，监测L1输出

检查：

1. 在输出数据中，每个时刻均有有效数据
2. 有效输出数据应与参考输出在每个时间步相等

#### 008 多层-1

测试设置：

- 两层Linear，第一层4bit权重，扇入扩展E=1，Linear尺寸(120, 600)，此时可容纳876。第二层8bit权重，扇入扩展E=8，Linear尺寸(600, 10)
- 设置Linear `tws=1`，`twe=0`；L2 `tws=2`，`twe=0`
- 运行5时间步，监测L2输出

检查：

1. 在输出数据中，从第2时刻开始才有有效数据。注意每个时间步L2的输入是上一个时刻的L1输出
2. 有效输出数据应与参考输出在每个时间步相等

## SNN算子

|         测试项目          | 结果  | 备注  |
| :-----------------------: | :---: | :---: |
| [001 Conv1d](#001-conv1d) |   ✅   |       |

### Conv1d

#### 001 Conv1d

测试设置：

- 仅一层IF，conv1d突触连接，输入特征图尺寸(8, 100)，卷积核尺寸(4, 8, 8)，s=1, p=0，输出特征图尺寸(4, 93)
- 设置IF正阈值10，`tws=1`，`twe=0`
- 运行5时间步，监测IF输出

检查：

1. 在输出数据中，每个时刻均有有效数据
2. 有效输出数据应与参考输出在每个时间步相等

## 半折叠算子

|                      测试项目                       | 结果  |    备注    |
| :-------------------------------------------------: | :---: | :--------: |
|    [001 Conv2dSemiFolded](#001-conv2dsemifolded)    |   ✅   |            |
|    [002 Conv2dSemiFolded](#002-conv2dsemifolded)    |   ❌   | 不完全相等 |
|    [003 Conv2dSemiFolded](#003-conv2dsemifolded)    |       |            |
|    [004 Conv2dSemiFolded](#004-conv2dsemifolded)    |       |            |
|    [005 Conv2dSemiFolded](#005-conv2dsemifolded)    |       |            |
|    [006 Conv2dSemiFolded](#006-conv2dsemifolded)    |   ❌   | 不完全相等 |
|    [007 Conv2dSemiFolded](#007-conv2dsemifolded)    |       |            |
|    [008 Conv2dSemiFolded](#008-conv2dsemifolded)    |       |            |
|    [009 Conv2dSemiFolded](#009-conv2dsemifolded)    |       |            |
| [010 MaxPool2dSemiFolded](#010-maxpool2dsemifolded) |       |            |
| [011 AvgPool2dSemiFolded](#011-avgpool2dsemifolded) |   ✅   |            |
| [012 Conv2dSemiFoldedNet](#012-conv2dsemifoldednet) |       |            |
| [013 Conv2dSemiFoldedNet](#013-conv2dsemifoldednet) |       |            |
|    [014 CNNSemiFoldedNet](#014-cnnsemifoldednet)    |       |            |

### 单层

#### 001 Conv2dSemiFolded

测试设置：

- 一层半折叠2d卷积
- 权重：随机权重
- 输入尺寸：(1, 64, 64)
- 卷积核尺寸：(4, 1, 7, 7)
- stride：1
- padding：0
- 输出尺寸：(4, 58, 58)
- 运行时间步：65，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 有效输出数据应与参考输出在每个时间步相等（若生成新数据）

#### 002 Conv2dSemiFolded

测试设置：

- 一层半折叠2d卷积
- 权重：随机权重
- 输入尺寸：(1, 8, 8)
- 卷积核尺寸：(1, 1, 2, 2)
- stride：2
- padding：0
- 输出尺寸：(1, 4, 4)
- 运行时间步：16，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 注意和003对比

#### 003 Conv2dSemiFolded

测试设置：

- 一层半折叠2d卷积
- 权重：全1
- 输入尺寸：(1, 8, 8)
- 卷积核尺寸：(1, 1, 2, 2)
- stride：2
- padding：0
- 输出尺寸：(1, 4, 4)
- 运行时间步：16，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 注意监测数据的计算，在出错时建议查看输入数据对比一下数据

#### 004 Conv2dSemiFolded

测试设置：

- 一层半折叠2d卷积
- 权重：全1
- 输入尺寸：(8, 64, 64)
- 卷积核尺寸：(4, 8, 7, 7)
- stride：2
- padding：0
- 输出尺寸：(4, 29, 29)
- 运行时间步：65，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 注意监测数据的计算，在出错时建议查看输入数据对比一下数据

#### 005 Conv2dSemiFolded

- 一层半折叠2d卷积
- 权重：权重全为正
- 输入尺寸：(8, 64, 64)
- 卷积核尺寸：(4, 8, 7, 7)
- stride：2
- padding：0
- 输出尺寸：(4, 29, 29)
- 运行时间步：65，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 有效输出数据应与参考输出在每个时间步相等（若生成新数据）

#### 006 Conv2dSemiFolded

测试设置：

- 一层半折叠2d卷积
- 权重：随机权重
- 输入尺寸：(1, 8, 8)
- 卷积核尺寸：(1, 1, 3, 3)
- stride：1
- padding：1
- 输出尺寸：(1, 8, 8)
- 运行时间步：10，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 注意和007对比

#### 007 Conv2dSemiFolded

测试设置：

- 一层半折叠2d卷积
- 权重：全1
- 输入尺寸：(1, 8, 8)
- 卷积核尺寸：(1, 1, 3, 3)
- stride：1
- padding：1
- 输出尺寸：(1, 8, 8)
- 运行时间步：10，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 注意监测数据的计算，在出错时建议查看输入数据对比一下数据

#### 008 Conv2dSemiFolded

测试设置：

- 一层半折叠2d卷积
- 权重：全1
- 输入尺寸：(8, 32, 32)
- 卷积核尺寸：(4, 8, 3, 3)
- stride：1
- padding：1
- 输出尺寸：(4, 32, 32)
- 运行时间步：35，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 有效输出数据应与参考输出在每个时间步相等（若生成新数据）

#### 009 Conv2dSemiFolded

测试设置：

- 一层半折叠2d卷积
- 权重：随机
- 输入尺寸：(8, 32, 32)
- 卷积核尺寸：(4, 8, 3, 3)
- stride：1
- padding：1
- 输出尺寸：(4, 32, 32)
- 运行时间步：35，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 有效输出数据应与参考输出在每个时间步相等（若生成新数据）

#### 010 MaxPool2dSemiFolded

测试设置：

- 一层半折叠2d最大池化
- 输入尺寸：(3, 32, 32)
- 池化核尺寸：(2, 2)
- stride：2
- padding：0
- 输出尺寸：(3, 16, 16)
- 运行时间步：32，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 有效输出数据应与参考输出在每个时间步相等（若生成新数据）

#### 011 AvgPool2dSemiFolded

测试设置：

- 一层半折叠2d平均池化
- 输入尺寸：(3, 32, 32)
- 池化核尺寸：(2, 2)
- stride：2
- padding：0
- 输出尺寸：(3, 16, 16)
- 运行时间步：32，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 有效输出数据应与参考输出在每个时间步相等（若生成新数据）

### 多层

#### 012 Conv2dSemiFoldedNet

测试设置：

- 三层：半折叠2d卷积 + 半折叠2d卷积 + 半折叠全连接
- 输入尺寸：(3, 32, 32)
- 第一层卷积核尺寸：(4, 3, 3, 3)，stride：1，padding：1
- 第二层卷积核尺寸：(4, 4, 3, 3)，stride：1，padding：1
- 第三层全连接尺寸：(4\*32\*32, 10)
- 输出尺寸：(10,)
- 运行时间步：40，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 有效输出数据应与参考输出在每个时间步相等（若生成新数据）

#### 013 Conv2dSemiFoldedNet

测试设置：

- 三层：半折叠2d卷积 + 半折叠2d卷积 + 半折叠全连接
- 输入尺寸：(3, 32, 32)
- 第一层卷积核尺寸：(4, 3, 4, 4)，stride：2，padding：1
- 第二层卷积核尺寸：(4, 4, 4, 4)，stride：2，padding：1
- 第三层全连接尺寸：(4\*8\*8, 10)
- 输出尺寸：(10,)
- 运行时间步：40，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 有效输出数据应与参考输出在每个时间步相等（若生成新数据）

#### 014 CNNSemiFoldedNet

测试设置：

- 五层：半折叠2d卷积 + 半折叠2d最大池化 + 半折叠2d卷积 + 半折叠2d最大池化 + 半折叠全连接
- 输入尺寸：(3, 32, 32)
- 第一层卷积核尺寸：(4, 3, 3, 3)，stride：1，padding：1
- 第二层池化核尺寸：(2, 2)，stride：2，padding：0
- 第三层卷积核尺寸：(4, 4, 3, 3)，stride：1，padding：1
- 第四层池化核尺寸：(2, 2)，stride：2，padding：0
- 第五层全连接尺寸：(4\*8\*8, 10)
- 输出尺寸：(10,)
- 运行时间步：42，监测输出

检查：

1. 在每个时间步的输出数据中，应有有效数据
2. 有效输出数据应与参考输出在每个时间步相等（若生成新数据）
